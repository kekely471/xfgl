<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <script src="${ctx.contextPath}/layui/commons/main.js" type="text/javascript"></script>
    <title>Title</title>

</head>

<body>
<div class="contentBox">
    <div class="formBox">
        <form class="layui-form" action="">
            <div class="layui-form-item layui-td-1">
                <label class="layui-form-label"><span class="redLabel">*</span>姓名</label>
                <div class="layui-input-block">
                    <input type="text" value="${RYGL.NAME}" id="name"name="name" autocomplete="off" class="layui-input"lay-verify="required" >
                </div>
            </div>
            <div class="layui-form-item layui-td-1">
                <label class="layui-form-label"><span class="redLabel">*</span>手机号码</label>
                <div class="layui-input-block">
                    <input type="text" name="phone" id="phone" value="${RYGL.PHONE}"  autocomplete="off" class="layui-input" lay-verify="required||phone" >
                </div>
            </div>
            <div class="layui-form-item layui-td-1">
                <label class="layui-form-label">邮箱</label>
                <div class="layui-input-block">
                    <input type="text" name="email" id="email" value="${RYGL.EMAIL}"  autocomplete="off" class="layui-input" >
                </div>
            </div>
            <div class="layui-form-item layui-td-1">
                <label class="layui-form-label"><span class="redLabel">*</span>身份证号</label>
                <div class="layui-input-block">
                    <input type="text" name="idcard" id="idcard" value="${RYGL.IDCARD}"lay-verify="required|identity"  autocomplete="off" class="layui-input" >
                </div>
            </div>
            <div class="layui-form-item layui-td-1">
                <label class="layui-form-label">职务</label>
                <div class="layui-input-block">
                <select name="job" id="job"  selectValue="${RYGL.JOB}" lay-search>
                    <option value="">请选择职务</option>
                </select>
                </div>
            </div>

            <div class="layui-form-item layui-td-1">
                <label class="layui-form-label">消防救援衔</label>
                <div class="layui-input-block">
                <select name="policerank" id="policerank" selectValue="${RYGL.POLICERANK}" lay-search>
                    <option value="">请选择消防救援衔</option>
                </select>
                </div>
            </div>

<!--            <div class="layui-form-item layui-td-1">-->
<!--                <label class="layui-form-label">单位编码</label>-->
<!--                <div class="layui-input-block">-->
<!--                    <input type="text" name="dwbm" id="dwbm" value="${RYGL.DWBM}"  autocomplete="off" class="layui-input" >-->
<!--                </div>-->
<!--            </div>-->
            <div class="layui-form-item layui-td-1">
                <label class="layui-form-label">部职级</label>
                <div class="layui-input-block">
                    <select name="dwmc" id="dwmc" lay-verify=""  selectValue="${RYGL.DWMC_TRUE}"  lay-search>
                        <option value="">请选择所在部职级</option>
                    </select>
                </div>
            </div>


<!--            <div class="layui-form-item layui-td-1">-->
<!--                <label class="layui-form-label">上级单位编码</label>-->
<!--                <div class="layui-input-block">-->
<!--                    <input type="text" name="sjdwbm" id="sjdwbm" value="${RYGL.SJDWBM}"  autocomplete="off" class="layui-input" >-->
<!--                </div>-->
<!--            </div>-->

            <div class="layui-form-item layui-td-1">
                <label class="layui-form-label">探亲休假天数</label>
                <div class="layui-input-block">
                    <input type="text" name="tqxjts" id="tqxjts" value="${RYGL.TQXJTS}"  autocomplete="off" class="layui-input" >
                </div>
            </div>

            <div class="layui-form-item layui-td-1">
                <label class="layui-form-label">探亲年假天数是否减半</label>
                <div class="layui-input-block">
                    <select name="tqxjtssfjb" id="tqxjtssfjb"  selectValue="${RYGL.TQXJTSSFJB}" lay-search>
                        <option value="">请选择</option>
                    </select>
                </div>
            </div>

            <div class="layui-form-item layui-td-1">
                <label class="layui-form-label">是否可以离队住宿(40天)</label>
                <div class="layui-input-block">
                    <select name="sfkyldzs" id="sfkyldzs"  selectValue="${RYGL.SFKYLDZS}" lay-search>
                        <option value="">请选择</option>
                    </select>
                </div>
            </div>
            <div class="layui-form-item layui-td-1">
                <label class="layui-form-label">年休假天数</label>
                <div class="layui-input-block">
                    <input type="text" name="nxjts" id="nxjts" value="${RYGL.NXJTS}"  autocomplete="off" class="layui-input" >
                </div>
            </div>
<!--            <div class="layui-form-item layui-td-1">-->
<!--                <label class="layui-form-label">上级单位名称</label>-->
<!--                <div class="layui-input-block">-->
<!--                <select name="sjdwmc" id="sjdwmc" selectValue="${RYGL.SJDWMC}" lay-search>-->
<!--                    <option value="">请选择上级单位名称</option>-->
<!--                </select>-->
<!--                </div>-->
<!--            </div>-->

            <div class="layui-form-item layui-td-1">
                <label class="layui-form-label">入伍年月</label>
                <div class="layui-input-block">
                    <input type="text" class="layui-input" id="rwny" name="rwny" value="${RYGL.RWNY}" placeholder="yyyy-MM">
                </div>
            </div>

            <div class="layui-form-item layui-td-1">
                <label class="layui-form-label">头像:</label>
                <div class="layui-input-block" id="imageSelectAreaAVATAR">
                    <input type="text" name="avatar" id="userFileIdAVATAR" autocomplete="off" class="layui-input"
                           value="${RYGL.AVATAR}" style="display:none"/>
                    <button type="button" class="layui-btn layui-btn-primary" id="imageSelectBtnAVATAR"><i class="layui-icon">&#xe67c;</i>选择图片
                    </button>
                </div>
            </div>



            <div class="layui-form-item layui-td-1">
                <label class="layui-form-label">是否启用</label>
                <div class="layui-input-block" >
                    <input type="checkbox" checked name="acc_status" id="acc_status" lay-skin="switch" lay-filter="switchTest" title="开关" value="${RYGL.ACC_STATUS}">
                </div>
            </div>


            <!--<div class="layui-form-item layui-td-1">-->
                <!--<label class="layui-form-label">是否启用</label>-->
                <!--<div class="layui-input-block" style="border: 0px solid #e6e6e6;padding-left: 10px;">-->
                    <!--[#if ACC_STATUS == 0]-->
                    <!--<input type="checkbox" name="acc_status" lay-skin="switch" lay-filter="switchTest" title="开关">-->
                    <!--[#else]-->
                    <!--<input type="checkbox" checked="" name="acc_status" lay-skin="switch" lay-filter="switchTest" title="开关">-->
                    <!--[/#if]-->
                <!--</div>-->
            <!--</div>-->
            <input type="hidden" name="id" value="${RYGL.ID}" autocomplete="off" class="layui-input">
            <button id="tj" style="display: none" lay-submit lay-filter="*">提交</button>
            <div class="clear"></div>
        </form>
    </div>
</div>

<script>
    var tabIndex = top.$(".layui-tab-title li.layui-this").attr("lay-id");
    var _id = "${id}";
    var isView = getParam("isView");
    layui.use(['form','layer','upload','laydate'], function() {
        var form = layui.form;
        var layer = layui.layer;
        var laydate = layui.laydate;
        var upload = layui.upload;

        laydate.render({
            elem: '#rwny'
            ,type: 'month'
            ,format:"yyyy/M"
            ,trigger: 'click'
        });
//        //是否启用
        if (_id) {
            isUse('acc_status', $("#acc_status").val());
        }
        form.render();

        initSelectBox("job", 'common/dict/business', '{"type_code":"zw"}', 'VALUE', 'NAME');
        initSelectBox("tqxjtssfjb", 'common/dict/business', '{"type_code":"sf"}', 'VALUE', 'NAME');
        initSelectBox("sfkyldzs", 'common/dict/business', '{"type_code":"sf"}', 'VALUE', 'NAME');
        initSelectBox("policerank", 'common/dict/business', '{"type_code":"jx"}', 'VALUE', 'NAME');
        // initSelectBox("dwmc", 'common/dict/business', '{"type_code":"dwmc"}', 'VALUE', 'NAME');
        initSelectBox("dwmc", 'common/dept', '', 'ID', 'NAME2');
        initSelectBox("sjdwmc", 'common/dict/business', '{"type_code":"sjdwmc"}', 'VALUE', 'NAME');



        form.render('select');

//        initSelectTxt(form);
        if ($("#userFileIdAVATAR").val() !== null && $("#userFileIdAVATAR").val().trim() != '') {
            $("#imageSelectBtnAVATAR").html(" <i class=\"layui-icon\">&#xe67c;</i>点击重新选择图片 ");
            $('#imageAreaAVATAR').remove();
            $('#imageSelectAreaAVATAR').append(" <div style=\"margin-top:10px;\" id=\"imageAreaAVATAR\"> " +
                " <img id=\"imagePathAVATAR\" style=\"width：200px; height:200px;\"> " +
                " </div> ");
            $("#imagePathAVATAR").attr('src', Apps.ContextPath + "file/download?id=" + $("#userFileIdAVATAR").val());
        } else {
            $("#imageSelectBtnAVATAR").html(" <i class=\"layui-icon\">&#xe67c;</i>选择图片 ");
        }
        if("${isView}"){
            $('input,select,textarea').prop('disabled',"disabled");
            $('#imageSelectBtn').hide();
            $('#imageSelectBtnAVATAR').hide();
        }


        if(isView == "true"){
            $("input").attr("disabled",true);
            $('dl').remove();
        }


        //监听提交
        form.on('submit()', function(data) {
            var datas = data.field;
            datas["type"] = "1";

            var ajax = new Ajax("rygl/save",function(data){
                if (judgeRight(data)) {

                    parent.layer.alert("操作成功!", {icon: 1}, function () {
                        if (parent.tableIns != null && parent.tableIns != "" && parent.tableIns != undefined) {
                            parent.tableIns.reload({where: {"type": "1"}});
                        }
                        parent.layer.closeAll();
                    });
                }

            });
            ajax.add(datas);
            ajax.submit();
            return false; //阻止表单跳转。如果需要表单跳转，去掉这段即可。
        });
        form.verify({
            phone: function (value) {
                if (value.length!=11) {
                    return '手机号码格式不正确';
                }
            },

      });



            //头像上传
        var uploadInst = upload.render({
            elem: '#imageSelectBtnAVATAR',
            url: Apps.ContextPath + '/file/upload',
            accept:'images',
            before: function (obj) {
                obj.preview(function (index, file, result) {
                    $('#imageAreaAVATAR').remove();
                    $('#imageSelectAreaAVATAR').append(" <div style=\"margin-top:10px;\" id=\"imageAreaAVATAR\"> " +
                        " <img id=\"imagePathAVATAR\" style=\"width：200px; height:200px;\"> " +
                        " </div> ");
                    $("#imagePathAVATAR").attr('src', result);
                    $("#imageSelectBtnAVATAR").html(" <i class=\"layui-icon\">&#xe67c;</i>重新选择图片 ");
                });
            },
            done: function (res) {
                if (res.code == 1) {
                    $("#imageSelectBtnAVATAR").html(" <i class=\"layui-icon\">&#xe67c;</i>上传成功,点击重新选择图片 ");
                    $("#userFileIdAVATAR").val(res.dataset.rows[0].id);
                }
            },
            error: function () {
                $("#imageSelectBtnAVATAR").html(" <i class=\"layui-icon\">&#xe67c;</i>上传失败,请重新选择图片 ");
            }
        });
    });


    function mySubmit(){
        $("#tj").click();
    }
//    function cancle() {
//        top.tab.tabDelete(tabIndex);
//    }
</script>
</body>

</html>