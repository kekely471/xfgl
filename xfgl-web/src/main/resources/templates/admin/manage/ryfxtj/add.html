<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <script src="${ctx.contextPath}/layui/commons/main.js" type="text/javascript"></script>
    <title>新增提交页面</title>
</head>
<body>
<div class="comtextBox">
    <div class="formBox">
        <form class="layui-form" action="">

            <div class="layui-form-item layui-td-1">
                <label class="layui-form-label">单位名称</label>
                <div class="layui-input-block">
                <select name="dwmc" id="dwmc"  selectValue="${RYFXTJ.DWMC}" lay-verify="required" disabled >
                <option value="">请选择单位</option>
                </select>
                    <input type="text" name="id" id="id" value="${id}" style="display: none;">
                </div>
            </div>

            <div class="layui-form-item layui-td-2">
                <label class="layui-form-label">消防员姓名</label>
                <div class="layui-input-block">
                    <select name="name" id="name" lay-verify="required" selectValue="${RYFXTJ.SS_ID}">
                        <option value="">请选择消防员姓名</option>
                    </select>
                </div>
            </div>

            <div class="layui-form-item layui-td-2">
                <label class="layui-form-label"></label>
                <div class="layui-input-block">
                    <div class="layui-input-inline layui-td-2">
                        <div class="layui-btn" id="query" onclick="search()">同步上季度</div>
                    </div>
                </div>
            </div>

            <div class="layui-form-item layui-td-2">
                <label class="layui-form-label">性别</label>
                <div class="layui-input-block">
                    <select name="sex" id="sex" selectValue="${RYFXTJ.SEX}" lay-verify="required">
                        <option value="">请选择性别</option>
                    </select>
                </div>
            </div>

            <div class="layui-form-item layui-td-2">
                <label class="layui-form-label">年龄</label>
                <div class="layui-input-block">
                    <input type="text" name="nl" id="nl" lay-verify="required" placeholder="" value="${RYFXTJ.NL}" autocomplete="off" class="layui-input" >
                </div>
            </div>

            <div class="layui-form-item layui-td-2">
                <label class="layui-form-label">民族</label>
                <div class="layui-input-block">
                    <input type="text" name="mz" id="mz" placeholder="" lay-verify="required" value="${RYFXTJ.MZ}" autocomplete="off" class="layui-input" >
                </div>
            </div>

            <div class="layui-form-item layui-td-2">
                <label class="layui-form-label">职级</label>
                <div class="layui-input-block">
                    <select name="zj" id="zj" selectValue="${RYFXTJ.ZJ}" lay-verify="required">
                        <option value="">请选择职级</option>
                    </select>
                </div>
            </div>

            <div class="layui-form-item layui-td-1">
                <label class="layui-form-label">身高</label>
                <div class="layui-input-block">
                    <input type="text" name="sg" id="sg" value="${RYFXTJ.SG}" lay-verify="required" autocomplete="off" class="layui-input" >
                </div>
            </div>
            <div class="layui-form-item layui-td-1">
                <label class="layui-form-label">基本资料</label>
                <div class="layui-input-block">
                    <textarea placeholder="请输入基本资料" lay-verify="required" class="layui-textarea" id="jbzl" name="jbzl" value="">${RYFXTJ.JBZL}</textarea>
                </div>
            </div>
            <div class="layui-form-item layui-td-1">
                <label class="layui-form-label">个人成长史</label>
                <div class="layui-input-block">
                    <textarea placeholder="请输入个人成长史" class="layui-textarea" lay-verify="required" id="grczs" name="grczs" value="">${RYFXTJ.GRCZS}</textarea>
                </div>
            </div>
            <div class="layui-form-item layui-td-1">
                <label class="layui-form-label">精神状态</label>
                <div class="layui-input-block">
                    <textarea placeholder="请输入精神状态" class="layui-textarea" lay-verify="required" id="jszt" name="jszt" value="">${RYFXTJ.JSZT}</textarea>
                </div>
            </div>
            <div class="layui-form-item layui-td-1">
                <label class="layui-form-label">身体状态</label>
                <div class="layui-input-block">
                    <textarea placeholder="请输入身体状态" lay-verify="required" class="layui-textarea" id="stzt" name="stzt" value="">${RYFXTJ.STZT}</textarea>
                </div>
            </div>
            <div class="layui-form-item layui-td-1">
                <label class="layui-form-label">社会功能</label>
                <div class="layui-input-block">
                    <textarea placeholder="请输入社会功能" lay-verify="required" class="layui-textarea" id="shgn" name="shgn" value="">${RYFXTJ.SHGN}</textarea>
                </div>
            </div>
            <div class="layui-form-item layui-td-1">
                <label class="layui-form-label">个人征信情况</label>
                <div class="layui-input-block">
                    <textarea placeholder="请输入个人征信情况" lay-verify="required" class="layui-textarea" id="grzxqk" name="grzxqk">${RYFXTJ.GRZXQK}</textarea>
                </div>
            </div>
            <div class="layui-form-item layui-td-1">
                <label class="layui-form-label">存在问题</label>
                <div class="layui-input-block">
                    <textarea placeholder="请输入存在问题" lay-verify="required" class="layui-textarea" id="czwt" name="czwt" value="">${RYFXTJ.CZWT}</textarea>
                </div>
            </div>
            <div class="layui-form-item layui-td-1">
                <label class="layui-form-label">对策分析</label>
                <div class="layui-input-block">
                    <textarea placeholder="请输入对策分析" lay-verify="required" class="layui-textarea" id="dcfx" name="dcfx" value="">${RYFXTJ.DCFX}</textarea>
                </div>
            </div>

            <div class="layui-form-item layui-td-1" style="text-align:center" id="rystatus">
                <input type="radio" name="rystatus"  value="1" title="正常" checked="" >
                <input type="radio" name="rystatus"  value="2" title="阶段性" >
                <input type="radio" name="rystatus"  value="3" title="重点观察" >
            </div>
            <div class="layui-form-item layui-layout-admin" id="sftj">
                <div class="layui-input-block">
                    <div class="layui-footer" style="left: 0;">
                        <button class="layui-layer-btn0" id="save" style="height: 28px;padding: 0px 15px;border-radius: 2px;margin: 5px 5px 0px;border-style: solid;bottom:0;" lay-submit lay-filter="save">保存</button>
                        <button class="layui-layer-btn0" id="tj" style="height: 28px;padding: 0px 15px;border-radius: 2px;margin: 5px 5px 0px;border-style: solid;bottom:0;" lay-submit lay-filter="tj">提交</button>
                    </div>
                </div>
            </div>
            <!--<button id="tj" style="display: none" lay-submit lay-filter="tj">提交</button>
            <button id="save" style="display: none" lay-submit lay-filter="save">保存</button>-->
            <div class="clear"></div>
        </form>
    </div>
</div>
<script>
    var form;
    var tabIndex = top.$(".layui-tab-title li.layui-this").attr("lay-id");
    var _id = "${id}";
    var sftj = "${RYFXTJ.SFTJ}";

    var isView = getParam("isView");
    layui.use(['form','layer','upload','laydate'], function() {
        form = layui.form;
        var layer = layui.layer;
        var laydate = layui.laydate;
        var upload = layui.upload;
        if (sftj ==1){
            $("#sftj").hide();
        }
//        //是否启用
        if (_id) {
            isUse('status', $("#status").val());
            isUse('sftj', $("#sftj").val());
            $("input[name='rystatus'][value='${RYFXTJ.RYSTATUS}']").attr("checked",true);
            form.render();
        }


        // initSelectBox("dwmc", 'common/dict/business', '{"type_code":"zw"}', 'VALUE', 'NAME');
       // initSelectBox("sftj", 'common/dict/business', '{"type_code":"sf"}', 'VALUE', 'NAME');
       // initSelectBox("name", 'common/dept',  '', 'name', 'NAME');
        initSelectBox("status", 'common/dict/business', '{"type_code":"gdyj"}', 'VALUE', 'NAME');
        initSelectBox("zj", 'common/dict/business', '{"type_code":"zw"}', 'VALUE', 'NAME');
        //initSelectBox("dwmc", 'common/dict/business', '{"type_code":"dwmc"}', 'VALUE', 'NAME');
        initSelectBox("dwmc", 'common/dept', '', 'ID', 'NAME2');
        initSelectBox("sex", 'common/dict/business', '{"type_code":"sex"}', 'VALUE', 'NAME');
//        initSelectTxt(form);
       initSelectBox("name", 'common/dict/xfy', '{"type_code":""}', 'SS_ID', 'NAME');

       /* //单位监听
        form.on('select(dwmc)', function (data) {

            initSelectBox("name", 'common/user', '{"deptId":"'+data.value+'"}', 'ID', 'NAME2');
        });*/

        form.render('select');


        //监听提交
        form.on('submit(save)', function(data) {
            /*debugger;*/
            var datas = data.field;
            var ajax = new Ajax("ryfxtj/save",function(data){
                if(judgeRight(data)){
                    parent.layer.alert("操作成功!",{icon:1},function(){
                        parent.tableIns.reload({where:{"v":Date.parse(new Date())}});
                        parent.layer.closeAll();
                    });
                }
            });
            ajax.add(datas);
            ajax.submit();
            return false; //阻止表单跳转。如果需要表单跳转，去掉这段即可。
        });

        form.on('submit(tj)', function(data) {
            var datas = data.field;
            var ajax = new Ajax("ryfxtj/tj",function(data){
                if(judgeRight(data)){
                    parent.layer.alert("操作成功!",{icon:1},function(){
                        parent.tableIns.reload({where:{"v":Date.parse(new Date())}});
                        parent.layer.closeAll();
                    });
                }
            });
            ajax.add(datas);
            ajax.submit();
            return false; //阻止表单跳转。如果需要表单跳转，去掉这段即可。
        });

        if(isView == "true"){
            $("input").attr("disabled",true);
            $('dl').remove();
        }

    });
    function search(){
        var ajax = new Ajax("/ryfxtj/tb", function (data) {

            if(data.dataset.rows.length!=0) {
                var sex = data.dataset.rows[0].SEX
                $("#sex").val(sex);
                $("#nl").val(data.dataset.rows[0].NL);
                $("#mz").val(data.dataset.rows[0].MZ);
                $("#zj").val(data.dataset.rows[0].ZJ);
                $("#sg").val(data.dataset.rows[0].SG);
                $("#jbzl").val(data.dataset.rows[0].JBZL);
                $("#grczs").val(data.dataset.rows[0].GRCZS);
                $("#jszt").val(data.dataset.rows[0].JSZT);
                $("#stzt").val(data.dataset.rows[0].STZT);
                $("#shgn").val(data.dataset.rows[0].SHGN);
                $("#grzxqk").val(data.dataset.rows[0].GRZXQK);
                $("#czwt").val(data.dataset.rows[0].CZWT);
                $("#dcfx").val(data.dataset.rows[0].DCFX);
                $("#rystatus").val(data.dataset.rows[0].RYSTATUS);
                $("input[name=rystatus][value='1']").attr("checked", data.dataset.rows[0].RYSTATUS == 1 ? true : false);
                $("input[name=rystatus][value='2']").attr("checked", data.dataset.rows[0].RYSTATUS == 2 ? true : false);
                $("input[name=rystatus][value='3']").attr("checked", data.dataset.rows[0].RYSTATUS == 3 ? true : false);

                form.render();

            }else{
                $("#sex").val('');
                $("#nl").val('');
                $("#mz").val('');
                $("#zj").val('');
                $("#sg").val('');
                $("#jbzl").val('');
                $("#grczs").val('');
                $("#jszt").val('');
                $("#stzt").val('');
                $("#shgn").val('');
                $("#grzxqk").val('');
                $("#czwt").val('');
                $("#dcfx").val('');

                form.render('select');
                return false;
            }





        });
        ajax.add("userId",$("#name").val());
        ajax.submit();



        // $.ajax({
        //     type : "GET",
        //     url : "/ryfxtj/tb",
        //     async : false,
        //     data : {},
        //     dataType : "html",
        //     timeout : 1000,
        //     success : function(dates) {
        //         $("#mainContent").html(dates);
        //         window.event.returnValue = false;
        //     },
        //     error : function() {
        //         console.log("请求失败，请重试！");
        //     }
        // });
    }

   /* function mySubmit(){
        $("#tj").click();
    }
    function mySubmit(){
        $("#save").click();
    }*/
    //    function cancle() {
    //        top.tab.tabDelete(tabIndex);
    //    }
</script>
</body>

</html>